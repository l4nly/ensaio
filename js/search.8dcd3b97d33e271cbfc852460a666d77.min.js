async function drawGraph(p,F,g,k){let{depth:h,enableDrag:l,enableLegend:A,enableZoom:E,opacityScale:O,scale:r,repelForce:S,fontSize:u}=k;const _=document.getElementById("graph-container"),{index:t,links:M,content:T}=await fetchData,z=window.location.origin+window.location.pathname,f=z.replace(/\/$/g,"").replace(p,""),b=e=>[...new Set(e.flatMap(e=>[e.source,e.target]))],j=JSON.parse(JSON.stringify(M)),o=new Set,i=[f||"/","__SENTINEL"];if(h>=0)for(;h>=0&&i.length>0;){const e=i.shift();if(e==="__SENTINEL")h--,i.push("__SENTINEL");else{o.add(e);const n=t.links[e]||[],s=t.backlinks[e]||[];i.push(...n.map(e=>e.target),...s.map(e=>e.source))}}else b(j).forEach(e=>o.add(e));const c={nodes:[...o].map(e=>({id:e})),links:j.filter(e=>o.has(e.source)&&o.has(e.target))},d=e=>{if(e.id===f||e.id==="/"&&f==="")return"var(--g-node-active)";for(const t of g){const n=Object.keys(t)[0],s=t[n];if(e.id.startsWith(n))return s}return"var(--g-node)"},x=t=>{function n(n,e){n.active||t.alphaTarget(1).restart(),e.fx=e.x,e.fy=e.y}function s(e,t){t.fx=e.x,t.fy=e.y}function o(n,e){n.active||t.alphaTarget(0),e.fx=null,e.fy=null}const e=()=>{};return d3.drag().on("start",l?n:e).on("drag",l?s:e).on("end",l?o:e)},n=Math.max(_.offsetHeight,F?500:250),e=_.offsetWidth,m=d3.forceSimulation(c.nodes).force("charge",d3.forceManyBody().strength(-100*S)).force("link",d3.forceLink(c.links).id(e=>e.id).distance(40)).force("center",d3.forceCenter()),s=d3.select("#graph-container").append("svg").attr("width",e).attr("height",n).attr("viewBox",[-e/2*1/r,-n/2*1/r,e*1/r,n*1/r]);if(A){const t=[{Current:"var(--g-node-active)"},{Note:"var(--g-node)"},...g];t.forEach((t,o)=>{const i=Object.keys(t)[0],a=t[i];s.append("circle").attr("cx",-e/2+20).attr("cy",n/2-30*(o+1)).attr("r",6).style("fill",a),s.append("text").attr("x",-e/2+40).attr("y",n/2-30*(o+1)).text(i).style("font-size","15px").attr("alignment-baseline","middle")})}const w=s.append("g").selectAll("line").data(c.links).join("line").attr("class","link").attr("stroke","var(--g-link)").attr("stroke-width",2).attr("data-source",e=>e.source.id).attr("data-target",e=>e.target.id),y=s.append("g").selectAll("g").data(c.nodes).enter().append("g"),a=e=>{const n=t.links[e.id]?.length||0,s=t.backlinks[e.id]?.length||0;return 3+(n+s)/4},v=y.append("circle").attr("class","node").attr("id",e=>e.id).attr("r",a).attr("fill",d).style("cursor","pointer").on("click",(t,e)=>{window.Million.navigate(new URL(`${p}${decodeURI(e.id).replace(/\s+/g,"-")}/`),".singlePage")}).on("mouseover",function(c,e){d3.selectAll(".node").transition().duration(100).attr("fill","var(--g-node-inactive)");const o=b([...t.links[e.id]||[],...t.backlinks[e.id]||[]]),i=d3.selectAll(".node").filter(e=>o.includes(e.id)),n=e.id;window.Million.prefetch(new URL(`${p}${decodeURI(e.id).replace(/\s+/g,"-")}/`));const r=d3.selectAll(".link").filter(e=>e.source.id===n||e.target.id===n);i.transition().duration(200).attr("fill",d),r.transition().duration(200).attr("stroke","var(--g-link-active)");const s=u*1.5;d3.select(this.parentNode).raise().select("text").transition().duration(200).attr("opacityOld",d3.select(this.parentNode).select("text").style("opacity")).style("opacity",1).style("font-size",s+"em").attr("dy",e=>a(e)+20+"px")}).on("mouseleave",function(s,t){d3.selectAll(".node").transition().duration(200).attr("fill",d);const e=t.id,n=d3.selectAll(".link").filter(t=>t.source.id===e||t.target.id===e);n.transition().duration(200).attr("stroke","var(--g-link)"),d3.select(this.parentNode).select("text").transition().duration(200).style("opacity",d3.select(this.parentNode).select("text").attr("opacityOld")).style("font-size",u+"em").attr("dy",e=>a(e)+8+"px")}).call(x(m)),C=y.append("text").attr("dx",0).attr("dy",e=>a(e)+8+"px").attr("text-anchor","middle").text(e=>T[e.id]?.title||e.id.replace("-"," ")).style("opacity",(O-1)/3.75).style("pointer-events","none").style("font-size",u+"em").raise().call(x(m));E&&s.call(d3.zoom().extent([[0,0],[e,n]]).scaleExtent([.25,4]).on("zoom",({transform:e})=>{w.attr("transform",e),v.attr("transform",e);const t=e.k*O,n=Math.max((t-1)/3.75,0);C.attr("transform",e).style("opacity",n)})),m.on("tick",()=>{w.attr("x1",e=>e.source.x).attr("y1",e=>e.source.y).attr("x2",e=>e.target.x).attr("y2",e=>e.target.y),v.attr("cx",e=>e.x).attr("cy",e=>e.y),C.attr("x",e=>e.x).attr("y",e=>e.y)})}